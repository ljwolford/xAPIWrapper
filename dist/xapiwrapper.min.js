/*! xAPIWrapper v 1.10.2 | Built on 2017-08-17 11:50:46-0400 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _getobj(a,b){var c=b.split("."),d=c[0];return b=c.slice(1).join("."),a[d]||(/\[\]$/.test(d)?(d=d.slice(0,-2),a[d]=[]):a[d]={}),b?_getobj(a[d],b):a[d]}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=d.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;return b&&c.mixIn(b),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),f=d.WordArray=e.extend({init:function(a,c){a=this.words=a||[],c!=b?this.sigBytes=c:this.sigBytes=4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,e=a.sigBytes;if(this.clamp(),d%4)for(var f=0;e>f;f++){var g=c[f>>>2]>>>24-f%4*8&255;b[d+f>>>2]|=g<<24-(d+f)%4*8}else if(c.length>65535)for(var f=0;e>f;f+=4)b[d+f>>>2]=c[f>>>2];else b.push.apply(b,c);return this.sigBytes+=e,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function p(){var p=e.clone.call(this);return p.words=this.words.slice(0),p},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new f.init(c,b)}}),g=c.enc={},h=g.Hex={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push((f>>>4).toString(16)),d.push((15&f).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new f.init(c,b/2)}},i=g.Latin1={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push(String.fromCharCode(f))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new f.init(c,b)}},j=g.Utf8={stringify:function(a){try{return decodeURIComponent(escape(i.stringify(a)))}catch(b){throw new Error("Malformed UTF-8 data")}},parse:function(a){return i.parse(unescape(encodeURIComponent(a)))}},k=(g.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,d=this._map;a.clamp();for(var e=[],f=0;c>f;f+=3)for(var g=b[f>>>2]>>>24-f%4*8&255,h=b[f+1>>>2]>>>24-(f+1)%4*8&255,i=b[f+2>>>2]>>>24-(f+2)%4*8&255,j=g<<16|h<<8|i,k=0;4>k&&c>f+.75*k;k++)e.push(d.charAt(j>>>6*(3-k)&63));var l=d.charAt(64);if(l)for(;e.length%4;)e.push(l);return e.join("")},parse:function(a){var b=a.length,c=this._map,d=c.charAt(64);if(d){var e=a.indexOf(d);-1!=e&&(b=e)}for(var g=[],h=0,i=0;b>i;i++)if(i%4){var j=c.indexOf(a.charAt(i-1))<<i%4*2,k=c.indexOf(a.charAt(i))>>>6-i%4*2;g[h>>>2]|=(j|k)<<24-h%4*8,h++}return f.create(g,h)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},d.BufferedBlockAlgorithm=e.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=j.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,g=this.blockSize,h=4*g,i=e/h;i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0);var j=i*g,k=a.min(4*j,e);if(j){for(var l=0;j>l;l+=g)this._doProcessBlock(d,l);var m=d.splice(0,j);c.sigBytes-=k}return new f.init(m,k)},clone:function q(){var q=e.clone.call(this);return q._data=this._data.clone(),q},_minBufferSize:0})),l=d.Hasher=k.extend({cfg:e.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}}),m=c.algo={},n=[],o=m.SHA1=l.extend({_doReset:function(){this._hash=new f.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=0;80>i;i++){if(16>i)n[i]=0|a[b+i];else{var j=n[i-3]^n[i-8]^n[i-14]^n[i-16];n[i]=j<<1|j>>>31}var k=(d<<5|d>>>27)+h+n[i];k+=20>i?(e&f|~e&g)+1518500249:40>i?(e^f^g)+1859775393:60>i?(e&f|e&g|f&g)-1894007588:(e^f^g)-899497514,h=g,g=f,f=e<<30|e>>>2,e=d,d=k}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+g|0,c[4]=c[4]+h|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;return c[e>>>5]|=128<<24-e%32,c[(e+64>>>9<<4)+14]=a.floor(d/4294967296),c[(e+64>>>9<<4)+15]=d,b.sigBytes=4*c.length,this._process(),this._hash},clone:function r(){var r=l.clone.call(this);return r._hash=this._hash.clone(),r}});return c.SHA1=l._createHelper(o),c.HmacSHA1=l._createHmacHelper(o),c}(Math),CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;a>e;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;a>e;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++){var e=b[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;b>i;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);if(function(a){for(var b=CryptoJS,c=b.lib,d=c.WordArray,e=c.Hasher,c=b.algo,f=[],g=[],h=function(a){return 4294967296*(a-(0|a))|0},i=2,j=0;64>j;){var k;a:{k=i;for(var l=a.sqrt(k),m=2;l>=m;m++)if(!(k%m)){k=!1;break a}k=!0}k&&(8>j&&(f[j]=h(a.pow(i,.5))),g[j]=h(a.pow(i,1/3)),j++),i++}var n=[],c=c.SHA256=e.extend({_doReset:function(){this._hash=new d.init(f.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],h=c[3],i=c[4],j=c[5],k=c[6],l=c[7],m=0;64>m;m++){if(16>m)n[m]=0|a[b+m];else{var o=n[m-15],p=n[m-2];n[m]=((o<<25|o>>>7)^(o<<14|o>>>18)^o>>>3)+n[m-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+n[m-16]}o=l+((i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25))+(i&j^~i&k)+g[m]+n[m],p=((d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22))+(d&e^d&f^e&f),l=k,k=j,j=i,i=h+o|0,h=f,f=e,e=d,d=o+p|0}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+h|0,c[4]=c[4]+i|0,c[5]=c[5]+j|0,c[6]=c[6]+k|0,c[7]=c[7]+l|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;return c[e>>>5]|=128<<24-e%32,c[(e+64>>>9<<4)+14]=a.floor(d/4294967296),c[(e+64>>>9<<4)+15]=d,b.sigBytes=4*c.length,this._process(),this._hash},clone:function(){var a=e.clone.call(this);return a._hash=this._hash.clone(),a}});b.SHA256=e._createHelper(c),b.HmacSHA256=e._createHmacHelper(c)}(Math),function(){var a=CryptoJS,b=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(a,c){a=this._hasher=new a.init,"string"==typeof c&&(c=b.parse(c));var d=a.blockSize,e=4*d;c.sigBytes>e&&(c=a.finalize(c)),c.clamp();for(var f=this._oKey=c.clone(),g=this._iKey=c.clone(),h=f.words,i=g.words,j=0;d>j;j++)h[j]^=1549556828,i[j]^=909522486;f.sigBytes=g.sigBytes=e,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var b=this._hasher;return a=b.finalize(a),b.reset(),b.finalize(this._oKey.clone().concat(a))}})}(),!Date.prototype.toISOString){var pad=function(a){var b=String(a);return 1===b.length&&(b="0"+b),b};Date.prototype.toISOString=function(){return(void 0).getUTCFullYear()+"-"+pad((void 0).getUTCMonth()+1)+"-"+pad((void 0).getUTCDate())+"T"+pad((void 0).getUTCHours())+":"+pad((void 0).getUTCMinutes())+":"+pad((void 0).getUTCSeconds())+"."+String(((void 0).getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}()}var inBrowser=!0;"undefined"!=typeof module?(CryptoJS=require("crypto-js"),inBrowser=!1):window.ADL=window.ADL||{};var Util=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"parseQueryString",value:function(a){if(!inBrowser)return"";var b=window.location.search.substring(1),c=b.split("&");if(a&&""!=a)for(var d=0;d<c.length;d++){var e=c[d].split("=");if(decodeURIComponent(e[0])==a)return decodeURIComponent(e[1])}for(var f=void 0,g={},h=0;h<c.length;h++)f=c[h].split("="),2===f.length&&f[0]&&(g[f[0]]=decodeURIComponent(f[1]));return g}},{key:"getLang",value:function(){var a=void 0;if("undefined"!=typeof navigator)a=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;else if(process&&process.env){var b=process.env.LANG;a=b.slice(0,b.indexOf(".")),a=a.replace(/_/,"-")}return a||"en-US"}},{key:"getLangVal",value:function(a){if(a){var b=Object.keys(a);if(0==b.length)return void 0;var c=this.getLang(),d=void 0,e=!1;do a[c]?(d=a[c],e=!0):c.indexOf("-")&&(c=c.substring(0,c.lastIndexOf("-")));while(!e&&""!==c);return d}}},{key:"ruuid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}},{key:"dateFromISOString",value:function(a){var b="([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T| ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?",c=a.match(new RegExp(b)),d=0,e=new Date(c[1],0,1);c[3]&&e.setMonth(c[3]-1),c[5]&&e.setDate(c[5]),c[7]&&e.setHours(c[7]),c[8]&&e.setMinutes(c[8]),c[10]&&e.setSeconds(c[10]),c[12]&&e.setMilliseconds(1e3*Number("0."+c[12])),c[14]&&(d=60*Number(c[16])+Number(c[17]),d*="-"==c[15]?1:-1),d-=e.getTimezoneOffset(),time=Number(e)+60*d*1e3;var f=new Date;return f.setTime(Number(time)),f}},{key:"getByteLen",value:function(a){a=String(a);for(var b=0,c=0;c<a.length;c++){var d=a.charCodeAt(c);b+=128>d?1:2048>d?2:65536>d?3:1<<21>d?4:1<<26>d?5:1<<31>d?6:Number.NaN}return b}},{key:"toBase64",value:function(a){return CryptoJS&&CryptoJS.enc.Base64?CryptoJS.enc.Base64.stringify(CryptoJS.enc.Latin1.parse(a)):Base64.encode(a)}},{key:"toSHA1",value:function(a){return CryptoJS&&CryptoJS.SHA1?CryptoJS.SHA1(a).toString():Crypto.util.bytesToHex(Crypto.SHA1(a,{asBytes:!0}))}},{key:"toSHA256",value:function(a){return CryptoJS&&CryptoJS.SHA256?CryptoJS.SHA256(a).toString():void 0}},{key:"isDate",value:function(a){var b=void 0;return b="[object Date]"===Object.prototype.toString.call(a)?a:new Date(a),"[object Date]"===Object.prototype.toString.call(b)?isNaN(b.valueOf())?null:b:null}}]),a}();"undefined"!=typeof module?module.exports=new Util:window.ADL.Util=new Util;var debug=!0,onBrowser=!0;if("undefined"!=typeof module){onBrowser=!1;var fetch=require("node-fetch");Util=require("./Utils.js")}else window.ADL=window.ADL||{},Util=window.ADL.Util;var Config=function(){var a={};a.endpoint="https://lrs.adlnet.gov/xapi/";try{a.auth="Basic "+Util.toBase64("tom:1234")}catch(b){console.log("Exception in Config trying to encode auth: "+b)}return a}(),log=function(a){debug&&console.log(a)},XAPIWrapper=function(){function a(){var b=this,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;if(_classCallCheck(this,a),this.lrs=this.getLRSObject(c),this.lrs.user&&this.lrs.password&&this.updateAuth(this.lrs,this.lrs.user,this.lrs.password),this.base=this.getbase(this.lrs.endpoint),this.withCredentials=c&&c.withCredentials,this.strictCallbacks=c&&c.strictCallbacks,this.xapiVersion="1.0.3",d&&this.testConfig()){var e={method:"GET",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth}};fetch(this.lrs.endpoint+"about",e).then(function(a){return a.json().then(function(c){if(a.ok){var d=c.version,e=!1;for(var f in d)if(d[f]==b.xapiVersion){e=!0;break}e||(log("Invalid xAPI Version: "+b.xapiVersion),log("Available versions are: "+JSON.stringify(d)))}})["catch"](function(a){log("Error thrown while verifying xAPI Version: "+a)})})}}return _createClass(a,[{key:"getbase",value:function(a){if(onBrowser){var b=document.createElement("a");return b.href=a,b.protocol&&b.host?b.protocol+"//"+b.host:void log("Couldn't create base url from endpoint: "+a)}}},{key:"updateAuth",value:function(a,b,c){a.auth="Basic "+Util.toBase64(b+":"+c)}},{key:"searchParams",value:function(){return{format:"exact"}}},{key:"hash",value:function(a){try{return Util.toSHA1(a)}catch(b){return log("Error trying to hash -- "+b),null}}},{key:"changeConfig",value:function(a){try{this.lrs=this.mergeRecursive(this.lrs,a),a.user&&a.password&&this.updateAuth(this.lrs,a.user,a.password),this.base=this.getbase(this.lrs.endpoint),this.withCredentials=a.withCredentials,this.strictCallbacks=a.strictCallbacks}catch(b){log("Error while changing configuration -- "+b)}}},{key:"prepareStatement",value:function(a){try{void 0===a.actor?a.actor=JSON.parse(this.lrs.actor):"string"==typeof a.actor&&(a.actor=JSON.parse(a.actor)),(this.lrs.grouping||this.lrs.registration||this.lrs.activity_platform)&&(a.context||(a.context={})),this.lrs.grouping&&(a.context.contextActivities||(a.context.contextActivities={}),a.context.contextActivities.grouping=[{id:this.lrs.grouping}]),this.lrs.registration&&(a.context.registration=this.lrs.registration),this.lrs.activity_platform&&(a.context.platform=this.lrs.activity_platform)}catch(b){log("Error while preparing statement: "+b)}}},{key:"buildMultipart",value:function(a,b,c){a.attachments=[];for(var d=0;d<b.length;d++)"signature"==b[d].type&&(b[d].type={usageType:"http://adlnet.gov/expapi/attachments/signature",display:{"en-US":"A JWT signature"},description:{"en-US":"A signature proving the statement was not modified"},contentType:"application/octet-stream"}),b[d].type.length=b[d].value.length,b[d].type.sha2=Util.toSHA256(b[d].value),a.attachments.push(b[d].type);var e="",f="\r\n",g=(Math.random()+" ").substring(2,10)+(Math.random()+" ").substring(2,10);c["Content-Type"]="multipart/mixed; boundary="+g,e+=f+"--"+g+f+"Content-Type:application/json"+f+'Content-Disposition: form-data; name="statement"'+f+f,e+=JSON.stringify(a);for(var h in b)e+=f+"--"+g+f+"X-Experience-API-Hash:"+b[h].type.sha2+f+"Content-Type:application/octet-stream"+f+"Content-Transfer-Encoding: binary"+f+f,e+=b[h].value;return e+=f+"--"+g+"--"+f}},{key:"putStatement",value:function(a,b,c,d){if(this.testConfig()&&a&&!(a instanceof Array)){if(!b||""==b)return c?void c("Error: invalid id"):new Promise(function(a,b){b("Error: invalid id")});if(d){var e=!0;if(Array.isArray(d)&&0!=d.length){for(var f in d)if(!(d[f]&&d[f].type&&d[f].value)){e=!1;break}}else e=!1;if(!e)return c?void c("Error: invalid attachment(s)"):new Promise(function(a,b){b("Error: invalid attachment(s)")})}a.id=b,this.prepareStatement(a);var g=JSON.stringify(a),h=null;d&&d.length>0&&(h={},g=this.buildMultipart(a,d,h));var i={url:this.lrs.endpoint+"statements?statementId="+b,method:"PUT",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth},body:g};return h&&Object.assign(i.headers,h),c?void this.callbackRequest(i,c,{id:b},!1):this.asyncRequest(i)}return c?void c("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"postStatement",value:function(a,b,c){if(this.testConfig()&&a&&!(a instanceof Array)){if(c){var d=!0;if(Array.isArray(c)&&0!=c.length){for(var e in c)if(!(c[e]&&c[e].type&&c[e].value)){d=!1;break}}else d=!1;if(!d)return b?void b("Error: invalid attachment(s)"):new Promise(function(a,b){b("Error: invalid attachment(s)")})}this.prepareStatement(a);var f=JSON.stringify(a),g=null;c&&c.length>0&&(g={},f=this.buildMultipart(a,c,g));var h={url:this.lrs.endpoint+"statements",method:"POST",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth},body:f};return g&&Object.assign(h.headers,g),b?void this.callbackRequest(h,b,{id:a.id},!1):this.asyncRequest(h)}return b?void b("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"postStatements",value:function(a,b){if(this.testConfig()&&a&&Array.isArray(a)&&a.length>0){for(var c in a)a.hasOwnProperty(c)&&this.prepareStatement(a[c]);var d=JSON.stringify(a),e={url:this.lrs.endpoint+"statements",method:"POST",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth},body:d};return b?void this.callbackRequest(e,b,null,!1):this.asyncRequest(e)}return b?void b("Error: invalid parameters"):new Promise(function(a,b){return a("Error: invalid parameters")})}},{key:"getStatements",value:function(a,b,c){if(this.testConfig()){var d=this.lrs.endpoint+"statements";if(b)d=this.base+b;else if(a){var e=new Array;for(var f in a)if("until"==f||"since"==f){var g=new Date(a[f]);e.push(f+"="+encodeURIComponent(g.toISOString()))}else e.push(f+"="+encodeURIComponent(a[f]));e.length>0&&(d=d+"?"+e.join("&"))}var h={url:d,method:"GET",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth}};return c?void this.callbackRequest(h,c,null,!1):this.asyncRequest(h)}return c?void c("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"getMoreStatements",value:function(a,b,c){if(this.testConfig()){var d=[];b&&this.getStatements(c,null,function e(f,g,h){g.ok&&h&&h.statements||b("Error: invalid response: "),d=d.concat(h.statements),a--<=0?b(null,null,d):h.more&&""!==h.more?this.getStatements(c,h.more,e):""===h.more&&b(null,null,d)})}else{if(!b)return new Promise(function(a,b){b("Error: invalid parameters")});b("Error: invalid parameters")}}},{key:"putState",value:function(a,b,c,d,e,f){if(this.testConfig()&&e&&a&&b&&c){var g=this.lrs.endpoint+"activities/state?activityId="+a+"&agent="+JSON.stringify(b)+"&stateId="+c;d&&(g+="&registration="+encodeURIComponent(d));var h={};e instanceof Array||e instanceof Object?(e=JSON.stringify(e),h["Content-Type"]="application/json"):h["Content-Type"]="application/octet-stream",h["X-Experience-API-Version"]=this.xapiVersion,h.Authorization=this.lrs.auth;var i={url:g,method:"PUT",headers:h,body:e};return f?void this.callbackRequest(i,f,null,!1):this.asyncRequest(i)}return f?void f("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"postState",value:function(a,b,c,d,e,f){if(this.testConfig()&&e&&a&&b&&c){var g=this.lrs.endpoint+"activities/state?activityId="+a+"&agent="+JSON.stringify(b)+"&stateId="+c;d&&(g+="&registration="+encodeURIComponent(d));var h={};e instanceof Array||e instanceof Object?(e=JSON.stringify(e),h["Content-Type"]="application/json"):h["Content-Type"]="application/octet-stream",h["X-Experience-API-Version"]=this.xapiVersion,h.Authorization=this.lrs.auth;var i={url:g,method:"POST",headers:h,body:e};return f?void this.callbackRequest(i,f,null,!1):this.asyncRequest(i)}return f?void f("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"getState",value:function(a,b,c,d,e,f){if(this.testConfig()&&a&&b){var g=this.lrs.endpoint+"activities/state?activityId="+a+"&agent="+JSON.stringify(b);c&&(g+="&stateId="+encodeURIComponent(c)),d&&(g+="&registration="+encodeURIComponent(d)),e&&(e=Util.isDate(e),null!=e&&(g+="&since="+encodeURIComponent(e.toISOString())));var h={url:g,method:"GET",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth}};return f?void this.callbackRequest(h,f,null,!0):this.asyncRequest(h)}return f?void f("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"deleteState",value:function(a,b,c,d,e){if(this.testConfig()&&a&&b){var f=this.lrs.endpoint+"activities/state?activityId="+a+"&agent="+JSON.stringify(b);c&&(f+="&stateId="+encodeURIComponent(c)),d&&(f+="&registration="+encodeURIComponent(d));var g={url:f,method:"DELETE",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth}};return e?void this.callbackRequest(g,e,null,!1):this.asyncRequest(g)}return e?void e("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"getActivities",value:function(a,b){if(this.testConfig()&&a&&""!=a){var c=this.lrs.endpoint+"activities?activityId="+a,d={url:c,method:"GET",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth}};return b?void this.callbackRequest(d,b,null,!0):this.asyncRequest(d)}return b?void b("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"putActivityProfile",value:function(a,b,c,d,e,f){if(this.testConfig()&&a&&b&&c){if("If-Match"!=d&&"If-None-Match"!=d)return f?void f("Error: invalid ETag header"):new Promise(function(a,b){b("Error: invalid ETag header")});if(!e||""==e)return f?void f("Error: invalid ETag hash"):new Promise(function(a,b){b("Error: invalid ETag hash")});var g=this.lrs.endpoint+"activities/profile?activityId="+a+"&profileId="+b,h={};h[""+d]=this.formatHash(e),c instanceof Array||c instanceof Object?(c=JSON.stringify(c),h["Content-Type"]="application/json"):h["Content-Type"]="application/octet-stream",h["X-Experience-API-Version"]=this.xapiVersion,h.Authorization=this.lrs.auth;var i={url:g,method:"PUT",headers:h,body:c};return f?void this.callbackRequest(i,f,null,!1):this.asyncRequest(i)}return f?void f("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"postActivityProfile",value:function(a,b,c,d){if(this.testConfig()&&a&&b&&c){var e=this.lrs.endpoint+"activities/profile?activityId="+a+"&profileId="+b,f={};c instanceof Array||c instanceof Object?(c=JSON.stringify(c),f["Content-Type"]="application/json"):f["Content-Type"]="application/octet-stream",f["X-Experience-API-Version"]=this.xapiVersion,f.Authorization=this.lrs.auth;var g={url:e,method:"POST",headers:f,body:c};return d?void this.callbackRequest(g,d,null,!1):this.asyncRequest(g)}return d?void d("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"getActivityProfile",value:function(a,b,c,d){if(this.testConfig()&&a){var e=this.lrs.endpoint+"activities/profile?activityId="+a;if(b&&(e+="&profileId="+encodeURIComponent(b)),c){if(c=Util.isDate(c),null==c)return d?void d("Error: invalid timestamp"):new Promise(function(a,b){b("Error: invalid timestamp")});e+="&since="+encodeURIComponent(c.toISOString())}var f={url:e,method:"GET",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth}};return d?void this.callbackRequest(f,d,null,!0):this.asyncRequest(f)}return d?void d("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"deleteActivityProfile",value:function(a,b,c){if(this.testConfig()&&a&&b){var d=this.lrs.endpoint+"activities/profile?activityId="+a+"&profileId="+b,e={url:d,method:"DELETE",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth}};return c?void this.callbackRequest(e,c,null,!1):this.asyncRequest(e)}return c?void c("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"getAgents",value:function(a,b){if(this.testConfig()&&a){var c=this.lrs.endpoint+"agents?agent="+JSON.stringify(a),d={url:c,method:"GET",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth}};return b?void this.callbackRequest(d,b,null,!0):this.asyncRequest(d)}return b?void b("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"putAgentProfile",value:function(a,b,c,d,e,f){if(this.testConfig()&&a&&b&&c){if("If-Match"!=d&&"If-None-Match"!=d)return f?void f("Error: invalid ETag header"):new Promise(function(a,b){b("Error: invalid ETag header")});if(!e||""==e)return f?void f("Error: invalid ETag hash"):new Promise(function(a,b){b("Error: invalid ETag hash")});var g=this.lrs.endpoint+"agents/profile?agent="+JSON.stringify(a)+"&profileId="+b,h={};h[""+d]=this.formatHash(e),c instanceof Array||c instanceof Object?(c=JSON.stringify(c),h["Content-Type"]="application/json"):h["Content-Type"]="application/octet-stream",h["X-Experience-API-Version"]=this.xapiVersion,h.Authorization=this.lrs.auth;var i={url:g,method:"PUT",headers:h,body:c};return f?void this.callbackRequest(i,f,null,!1):this.asyncRequest(i)}return f?void f("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"postAgentProfile",value:function(a,b,c,d){if(this.testConfig()&&a&&b&&c){var e=this.lrs.endpoint+"agents/profile?agent="+JSON.stringify(a)+"&profileId="+b,f={};c instanceof Array||c instanceof Object?(c=JSON.stringify(c),f["Content-Type"]="application/json"):f["Content-Type"]="application/octet-stream",f["X-Experience-API-Version"]=this.xapiVersion,f.Authorization=this.lrs.auth;var g={url:e,method:"POST",headers:f,body:c};return d?void this.callbackRequest(g,d,null,!1):this.asyncRequest(g)}return d?void d("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"getAgentProfile",value:function(a,b,c,d){if(this.testConfig()&&a){var e=this.lrs.endpoint+"agents/profile?agent="+JSON.stringify(a);if(b&&(e+="&profileId="+encodeURIComponent(b)),c){if(c=Util.isDate(c),null==c)return d?void d("Error: invalid timestamp"):new Promise(function(a,b){b("Error: invalid timestamp")});e+="&since="+encodeURIComponent(c.toISOString())}var f={url:e,method:"GET",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth}};return d?void this.callbackRequest(f,d,null,!0):this.asyncRequest(f)}return d?void d("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"deleteAgentProfile",value:function(a,b,c){if(this.testConfig()&&a&&b){var d=this.lrs.endpoint+"agents/profile?agent="+JSON.stringify(a)+"&profileId="+b,e={url:d,method:"DELETE",headers:{"Content-Type":"application/json","X-Experience-API-Version":this.xapiVersion,Authorization:this.lrs.auth}};return c?void this.callbackRequest(e,c,null,!1):this.asyncRequest(e)}return c?void c("Error: invalid parameters"):new Promise(function(a,b){b("Error: invalid parameters")})}},{key:"asyncRequest",value:function(a){return new Promise(function(b,c){fetch(a.url,a).then(function(a){return a.json().then(function(c){return b({resp:a,data:c})})["catch"](function(d){a.ok?b({resp:a}):c(412!=a.status?d:a.status)})})})}},{key:"ieRequest",value:function(a,b,c,d){var e=b,f=new Array,g=e.indexOf("?");if(g>0&&(f.push(e.substr(g+1)),e=e.substr(0,g)),e=e+"?method="+a,null!==c)for(var h in c)f.push(h+"="+encodeURIComponent(c[h]));return null!==d&&f.push("content="+encodeURIComponent(d)),{method:"POST",url:e,headers:{},data:f.join("&")}}},{key:"callbackRequest",value:function(a,b,c,d){var e=this,f=void 0,g=!1,h=!1,i=!1,j=void 0,k=a.url.toLowerCase().match(/^(.+):\/\/([^:\/]*):?(\d+)?(\/.*)?$/),l=onBrowser?window.location:"",m=void 0,n=void 0;h=l.protocol!==k[1]||l.hostname!==k[2],h||(m=null===k[3]?"http"===k[1]?"80":"443":k[3],h=m===l.port);var o=!1;if(onBrowser&&(o=window.XDomainRequest&&window.fetch&&void 0===fetch.responseType),h&&void 0!==o&&o!==!1?(i=!0,j=this.ieRequest(a.method,a.url,a.headers,a.data),f=new XDomainRequest,f.open(j.method,j.url)):fetch(a.url,a).then(function(a){return a.json().then(function(d){c?e.strictCallbacks?b(null,a,c):b(a,c):e.strictCallbacks?b(null,a,d):b(a,d)})["catch"](function(d){a.ok?c?e.strictCallbacks?b(null,a,c):b(a,c):e.strictCallbacks?b(null,a,null):b(a,null):e.strictCallbacks?(log(d),e.requestError(a,b,c)):b(412==a.status?a.status:d)})}),i)for(n=1e3+new Date;new Date<n&&4!==f.readyState&&!g;)this.delay()}},{key:"requestError",value:function(a,b,c){if(b){var d=a?a.status:void 0,e=void 0;if(e=d?new Error("Request error: "+d):new Error("Request error: unknown"),c)b(e,a,c);else{var f;try{f=JSON.parse(a.responseText)}catch(g){f=a.responseText}b(e,a,f)}}}},{key:"testConfig",value:function(){return void 0!=this.lrs.endpoint&&""!=this.lrs.endpoint}},{key:"getLRSObject",value:function(a){var b=["endpoint","auth","actor","registration","activity_id","grouping","activity_platform"],c=new Object,d=void 0,e=void 0;if(d=Util.parseQueryString(),void 0!==d&&0!==Object.keys(d).length){for(var f=0;f<b.length;f++)e=b[f],d[e]&&(c[e]=d[e],delete d[e]);0!==Object.keys(d).length&&(c.extended=d),c=this.mergeRecursive(a,c)}else c=a;return c}},{key:"mergeRecursive",value:function(a,b){return Object.assign(a,a,b)}},{key:"delay",value:function(){var a=void 0,b=void 0;onBrowser?(a=new XMLHttpRequest,b=window.location):a=new XmlHttpRequest,b+="?forcenocache="+Util.ruuid(),a.open("GET",b,!1),
a.send(null)}},{key:"formatHash",value:function(a){return"*"===a?a:'"'+a+'"'}}]),a}();onBrowser?window.ADL.XAPIWrapper=new XAPIWrapper(Config,!1):module.exports=new XAPIWrapper(Config,!1);var activityTypes={assessment:"http://adlnet.gov/expapi/activities/assessment",attempt:"http://adlnet.gov/expapi/activities/attempt",course:"http://adlnet.gov/expapi/activities/course",file:"http://adlnet.gov/expapi/activities/file",interaction:"http://adlnet.gov/expapi/activities/interaction",lesson:"http://adlnet.gov/expapi/activities/lesson",link:"http://adlnet.gov/expapi/activities/link",media:"http://adlnet.gov/expapi/activities/media",meeting:"http://adlnet.gov/expapi/activities/meeting",module:"http://adlnet.gov/expapi/activities/module",objective:"http://adlnet.gov/expapi/activities/objective",performance:"http://adlnet.gov/expapi/activities/performance",profile:"http://adlnet.gov/expapi/activities/profile",question:"http://adlnet.gov/expapi/activities/question",simulation:"http://adlnet.gov/expapi/activities/simulation"};"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=activityTypes:window.ADL.activityTypes=activityTypes;var verbs={abandoned:{id:"https://w3id.org/xapi/adl/verbs/abandoned",display:{"en-US":"abandoned"}},answered:{id:"http://adlnet.gov/expapi/verbs/answered",display:{"de-DE":"beantwortete","en-US":"answered","fr-FR":"a répondu","es-ES":"contestó"}},asked:{id:"http://adlnet.gov/expapi/verbs/asked",display:{"de-DE":"fragte","en-US":"asked","fr-FR":"a demandé","es-ES":"preguntó"}},attempted:{id:"http://adlnet.gov/expapi/verbs/attempted",display:{"de-DE":"versuchte","en-US":"attempted","fr-FR":"a essayé","es-ES":"intentó"}},attended:{id:"http://adlnet.gov/expapi/verbs/attended",display:{"de-DE":"nahm teil an","en-US":"attended","fr-FR":"a suivi","es-ES":"asistió"}},commented:{id:"http://adlnet.gov/expapi/verbs/commented",display:{"de-DE":"kommentierte","en-US":"commented","fr-FR":"a commenté","es-ES":"comentó"}},completed:{id:"http://adlnet.gov/expapi/verbs/completed",display:{"de-DE":"beendete","en-US":"completed","fr-FR":"a terminé","es-ES":"completó"}},exited:{id:"http://adlnet.gov/expapi/verbs/exited",display:{"de-DE":"verließ","en-US":"exited","fr-FR":"a quitté","es-ES":"salió"}},experienced:{id:"http://adlnet.gov/expapi/verbs/experienced",display:{"de-DE":"erlebte","en-US":"experienced","fr-FR":"a éprouvé","es-ES":"experimentó"}},failed:{id:"http://adlnet.gov/expapi/verbs/failed",display:{"de-DE":"verfehlte","en-US":"failed","fr-FR":"a échoué","es-ES":"fracasó"}},imported:{id:"http://adlnet.gov/expapi/verbs/imported",display:{"de-DE":"importierte","en-US":"imported","fr-FR":"a importé","es-ES":"importó"}},initialized:{id:"http://adlnet.gov/expapi/verbs/initialized",display:{"de-DE":"initialisierte","en-US":"initialized","fr-FR":"a initialisé","es-ES":"inicializó"}},interacted:{id:"http://adlnet.gov/expapi/verbs/interacted",display:{"de-DE":"interagierte","en-US":"interacted","fr-FR":"a interagi","es-ES":"interactuó"}},launched:{id:"http://adlnet.gov/expapi/verbs/launched",display:{"de-DE":"startete","en-US":"launched","fr-FR":"a lancé","es-ES":"lanzó"}},mastered:{id:"http://adlnet.gov/expapi/verbs/mastered",display:{"de-DE":"meisterte","en-US":"mastered","fr-FR":"a maîtrisé","es-ES":"dominó"}},passed:{id:"http://adlnet.gov/expapi/verbs/passed",display:{"de-DE":"bestand","en-US":"passed","fr-FR":"a réussi","es-ES":"aprobó"}},preferred:{id:"http://adlnet.gov/expapi/verbs/preferred",display:{"de-DE":"bevorzugte","en-US":"preferred","fr-FR":"a préféré","es-ES":"prefirió"}},progressed:{id:"http://adlnet.gov/expapi/verbs/progressed",display:{"de-DE":"machte Fortschritt mit","en-US":"progressed","fr-FR":"a progressé","es-ES":"progresó"}},registered:{id:"http://adlnet.gov/expapi/verbs/registered",display:{"de-DE":"registrierte","en-US":"registered","fr-FR":"a enregistré","es-ES":"registró"}},responded:{id:"http://adlnet.gov/expapi/verbs/responded",display:{"de-DE":"reagierte","en-US":"responded","fr-FR":"a répondu","es-ES":"respondió"}},resumed:{id:"http://adlnet.gov/expapi/verbs/resumed",display:{"de-DE":"setzte fort","en-US":"resumed","fr-FR":"a repris","es-ES":"continuó"}},satisfied:{id:"https://w3id.org/xapi/adl/verbs/satisfied",display:{"en-US":"satisfied"}},scored:{id:"http://adlnet.gov/expapi/verbs/scored",display:{"de-DE":"erreichte","en-US":"scored","fr-FR":"a marqué","es-ES":"anotó"}},shared:{id:"http://adlnet.gov/expapi/verbs/shared",display:{"de-DE":"teilte","en-US":"shared","fr-FR":"a partagé","es-ES":"compartió"}},suspended:{id:"http://adlnet.gov/expapi/verbs/suspended",display:{"de-DE":"pausierte","en-US":"suspended","fr-FR":"a suspendu","es-ES":"aplazó"}},terminated:{id:"http://adlnet.gov/expapi/verbs/terminated",display:{"de-DE":"beendete","en-US":"terminated","fr-FR":"a terminé","es-ES":"terminó"}},voided:{id:"http://adlnet.gov/expapi/verbs/voided",display:{"de-DE":"entwertete","en-US":"voided","fr-FR":"a annulé","es-ES":"anuló"}},waived:{id:"https://w3id.org/xapi/adl/verbs/waived",display:{"en-US":"waived"}}};"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=verbs:window.ADL.verbs=verbs;var Agent=function(){function a(b,c){_classCallCheck(this,a),this.objectType="Agent",c&&(this.name=c),b&&(b.mbox||b.mbox_sha1sum||b.openid||b.account?Object.assign(this,b):/^mailto:/.test(b)?this.mbox=b:/^[0-9a-f]{40}$/i.test(b)?this.mbox_sha1sum=b:/^http[s]?:/.test(b)?this.openid=b:b.homePage&&b.name&&(this.account=b))}return _createClass(a,[{key:"toString",value:function(){return JSON.stringify(this,null,"  ")}},{key:"isValid",value:function(){return(void 0!=this.mbox||void 0!=this.mbox_sha1sum||void 0!=this.openid||void 0!=this.account&&void 0!=this.account.homePage&&void 0!=this.account.name)&&(!this.objectType||"Agent"===this.objectType)}},{key:"show",value:function(){console.log(this.toString())}},{key:"getType",value:function(){return"Agent"}},{key:"getId",value:function(){return this.mbox||this.openid||this.mbox_sha1sum||this.account&&this.account.homePage&&this.account.name}},{key:"getIdString",value:function(){var a=this.mbox||this.openid||this.mbox_sha1sum;return!a&&this.account?this.account.homePage+":"+this.account.name:a||"unknown"}},{key:"getDisplay",value:function(){return this.isValid()?this.name||this.getIdString():null}}]),a}(),Group=function(){function a(b,c,d){if(_classCallCheck(this,a),this.objectType="Group",d&&(this.name=d),c&&this.isValidMembers(c)&&(this.member=c),b)if("Group"===b.objectType){var e=!1;if(b.member){if(!this.isValidMembers(b.member))return;e=!0}var f=!1;if(b.mbox||b.mbox_sha1sum||b.openid)f=!0;else if(b.account){if(!b.account.homePage||!b.account.name)return;f=!0}(e||f)&&Object.assign(this,b)}else/^mailto:/.test(b)?this.mbox=b:/^[0-9a-f]{40}$/i.test(b)?this.mbox_sha1sum=b:/^http[s]?:/.test(b)?this.openid=b:b.homePage&&b.name&&(this.account=b)}return _createClass(a,[{key:"toString",value:function(){return JSON.stringify(this,null,"  ")}},{key:"isValid",value:function(){return(void 0!=this.mbox||void 0!=this.mbox_sha1sum||void 0!=this.openid||void 0!=this.account&&this.account.homePage&&this.account.name||void 0!=this.member&&this.isValidMembers(this.member))&&void 0!=this.objectType&&"Group"===this.objectType}},{key:"isValidMembers",value:function(a){if(!a)return!1;if(!(Array.isArray(a)&&a.length>0))return console.log("Invalid parameter: members="+a),!1;for(var b=0;b<a.length;b++)if("Group"==a[b].objectType||a[b].hasOwnProperty("member"))return!1;return!0}},{key:"show",value:function(){console.log(this.toString())}},{key:"getType",value:function(){return"Group"}},{key:"getId",value:function(){return this.mbox||this.openid||this.mbox_sha1sum||this.account&&this.account.homePage&&this.account.name}},{key:"getIdString",value:function(){var a=this.mbox||this.openid||this.mbox_sha1sum;return a||(a="unknown",this.account?a=this.account.homePage+":"+this.account.name:this.member&&this.isValidMembers(this.member)&&(a="Anonymous Group")),a}},{key:"getDisplay",value:function(){return this.isValid()?this.name||this.getIdString():null}}]),a}();"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports={Agent:Agent,Group:Group}:(window.ADL.Agent=Agent,window.ADL.Group=Group),"undefined"!=typeof module&&(Util=require("./Utils.js"));var Verb=function(){function a(b,c){return _classCallCheck(this,a),b&&b.id?void Object.assign(this,b):(b&&(this.id="string"==typeof b||b instanceof String?b:""),void(c&&(this.display="string"==typeof c||c instanceof String?{"en-US":c}:c)))}return _createClass(a,[{key:"toString",value:function(){return JSON.stringify(this,null,"  ")}},{key:"isValid",value:function(){return void 0!=this.id&&""!=this.id}},{key:"show",value:function(){console.log(this.toString())}},{key:"getDisplay",value:function(){return this.isValid()?this.display?Util.getLangVal(this.display):this.id:null}}]),a}();"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=Verb:window.ADL.Verb=Verb,"undefined"!=typeof module&&(Util=require("./Utils.js"));var Activity=function(){function a(b,c,d){return _classCallCheck(this,a),this.objectType="Activity",b&&b.id?void Object.assign(this,b):(b&&(this.id="string"==typeof b||b instanceof String?b:""),c&&(this.definition={},this.definition.name="string"==typeof c||c instanceof String?{"en-US":c}:c),void(d&&(this.definition=this.definition||{},this.definition.description="string"==typeof d||d instanceof String?{"en-US":d}:d)))}return _createClass(a,[{key:"toString",value:function(){return JSON.stringify(this,null,"  ")}},{key:"isValid",value:function(){return void 0!=this.id&&""!=this.id&&this.isValidInteraction(this.definition)&&(!this.objectType||"Activity"===this.objectType)}},{key:"isValidInteraction",value:function(a){if(void 0===a)return!0;if(void 0!=a.interactionType){if("string"!=typeof a.interactionType)return!1;if("true-false"!=a.interactionType&&"choice"!=a.interactionType&&"fill-in"!=a.interactionType&&"long-fill-in"!=a.interactionType&&"matching"!=a.interactionType&&"performance"!=a.interactionType&&"sequencing"!=a.interactionType&&"likert"!=a.interactionType&&"numeric"!=a.interactionType&&"other"!=a.interactionType)return!1}return void 0!=a.extensions&&"object"!=_typeof(a.extensions)?!1:!0}},{key:"show",value:function(){console.log(this.toString())}},{key:"getType",value:function(){return"Activity"}},{key:"getId",value:function(){return this.id}},{key:"getDisplay",value:function(){return this.isValid()?this.definition&&this.definition.name?Util.getLangVal(this.definition.name):this.id:null}}]),a}(),StatementRef=function(){function a(b){return _classCallCheck(this,a),this.objectType="StatementRef",b&&b.id?void Object.assign(this,b):void(b&&(this.id="string"==typeof b||b instanceof String?b:""))}return _createClass(a,[{key:"toString",value:function(){return JSON.stringify(this,null,"  ")}},{key:"isValid",value:function(){return void 0!=this.id&&""!=this.id&&"StatementRef"===this.objectType}},{key:"show",value:function(){console.log(this.toString())}},{key:"getType",value:function(){return"StatementRef"}},{key:"getId",value:function(){return this.id}}]),a}();"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports={Activity:Activity,StatementRef:StatementRef}:(window.ADL.Activity=Activity,window.ADL.StatementRef=StatementRef),"undefined"!=typeof module?(Agent=require("./Agent").Agent,Group=require("./Agent").Group,Verb=require("./Verb"),Activity=require("./Object").Activity,StatementRef=require("./Object").StatementRef,Util=require("./Utils.js")):(Agent=window.ADL.Agent,Group=window.ADL.Group,Verb=window.ADL.Verb,Activity=window.ADL.Activity,StatementRef=window.ADL.StatementRef);var Statement=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,a),b&&b.actor&&b.verb&&b.object&&(Object.assign(this,b),c=b.verb,d=b.object,b=b.actor),this.actor=b,b&&("Agent"!==b.objectType&&b.objectType||b instanceof Agent?"Group"!==b.objectType||b instanceof Group||(this.actor=new Group(b)):this.actor=new Agent(b)),this.verb=c,!c||c instanceof Verb||(this.verb=new Verb(c)),this.object=d,d&&("Activity"!==d.objectType&&d.objectType||d instanceof Activity?"Agent"!==d.objectType||d instanceof Agent?"Group"!==d.objectType||d instanceof Group?"StatementRef"!==d.objectType||d instanceof StatementRef?"SubStatement"!==d.objectType||d instanceof SubStatement||(this.object=new SubStatement(d)):this.object=new StatementRef(d):this.object=new Group(d):this.object=new Agent(d):this.object=new Activity(d)),this.id=Util.ruuid()}return _createClass(a,[{key:"toString",value:function(){return"\n"+JSON.stringify(this,null,"  ")+"\n"}},{key:"isValid",value:function(){return void 0!=this.actor&&this.actor.isValid()&&void 0!=this.verb&&this.verb.isValid()&&void 0!=this.object&&this.object.isValid()}},{key:"show",value:function(){console.log(this.toString())}},{key:"generateRegistration",value:function(){_getobj(this,"context").registration=Util.ruuid()}},{key:"addParentActivity",value:function(a){_getobj(this,"context.contextActivities.parent[]").push(new Activity(a))}},{key:"addGroupingActivity",value:function(a){_getobj(this,"context.contextActivities.grouping[]").push(new Activity(a))}},{key:"addOtherContextActivity",value:function(a){_getobj(this,"context.contextActivities.other[]").push(new Activity(a))}}]),a}(),SubStatement=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,a),this.objectType="SubStatement",b&&(b.actor&&b.verb&&b.object&&(Object.assign(this,b),c=b.verb,d=b.object,b=b.actor),"Agent"!==b.objectType&&b.objectType?"Group"===b.objectType&&(this.actor=b instanceof Group?b:new Group(b)):this.actor=b instanceof Agent?agent:new Agent(b)),c&&(this.verb=c instanceof Verb?c:new Verb(c)),d&&("Activity"!==d.objectType&&d.objectType?"Agent"===d.objectType?this.object=d instanceof Agent?d:new Agent(d):"Group"===d.objectType?this.object=d instanceof Group?d:new Group(d):"StatementRef"===d.objectType&&(this.object=d instanceof StatementRef?d:new StatementRef(d)):this.object=d instanceof Activity?d:new Activity(d))}return _createClass(a,[{key:"toString",value:function(){return JSON.stringify(this,null,"  ")}},{key:"isValid",value:function(){return void 0!=this.actor&&this.actor.isValid()&&void 0!=this.verb&&this.verb.isValid()&&void 0!=this.object&&this.object.objectType!=this.objectType&&this.object.isValid()&&"SubStatement"===this.objectType&&!this.hasOwnProperty("id")&&!this.hasOwnProperty("stored")&&!this.hasOwnProperty("version")&&!this.hasOwnProperty("authority")}},{key:"show",value:function(){console.log(this.toString())}},{key:"getType",value:function(){return"SubStatement"}},{key:"getDisplay",value:function(){return this.isValid()?this.actor.getId()+":"+this.verb.getDisplay()+":"+this.object.getId():null}}]),a}();if("undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports={Statement:Statement,SubStatement:SubStatement}:(window.ADL.Statement=Statement,window.ADL.SubStatement=SubStatement),"undefined"!=typeof module){var fetch=require("node-fetch");inBrowser=!1}else window.ADL=window.ADL||{};var cb_wrap=function(a){return function(){var b=arguments;window.setTimeout(function(){for(var c=[],d=0;d<b.length;d++)c.push(b[d]);a.apply(window,c)},0)}},observeForNewULinks=function(){var a=document.body,b=new MutationObserver(function(a){a.forEach(function(a){for(var b in a.addedNodes)if(a.addedNodes[b].constructor==HTMLAnchorElement){var c=a.addedNodes[b];setupCourseLinks([c])}})}),c={attributes:!0,childList:!0,subtree:!0};b.observe(a,c)},setupCourseLinks=function(a){var b=ADL.Util.parseQueryString("xAPILaunchKey"),c=ADL.Util.parseQueryString("xAPILaunchService"),d=ADL.Util.parseQueryString("encrypted"),e="xAPILaunchKey="+b+"&xAPILaunchService="+c;d&&(e+="&encrypted=true");for(var f=0;f<a.length;f++){var g=a[f],h=g.href,i=g.attributes.getNamedItem("courselink");i&&"true"==i.value&&(g.href=h.indexOf("?")>-1?h+"&"+e:h+"?"+e)}},xAPILaunch=function a(b,c,d){b=cb_wrap(b);try{var e=ADL.Util.parseQueryString("xAPILaunchKey"),f=ADL.Util.parseQueryString("xAPILaunchService");ADL.Util.parseQueryString("encrypted");if(a.terminate=function(a){var b=new URL(f);b.pathname+="launch/"+e+"/terminate";var c=new XMLHttpRequest;c.withCredentials=!0,c.crossDomain=!0,c.open("POST",b.toString(),!1),c.setRequestHeader("Content-type","application/json"),c.send(JSON.stringify({code:0,description:a||"User closed content"}))},!e||!f)return b("invalid launch parameters");var g=new URL(f);g.pathname+="launch/"+e;var h=new XMLHttpRequest;h.withCredentials=!0,h.crossDomain=!0,h.onerror=function(a){window.setTimeout(function(){return b(a)})},h.onload=function(e){if(200!==h.status)return h.onerror(h.responseText);var f=JSON.parse(h.responseText),g=f,i={};i.endpoint=g.endpoint,i.actor=g.actor,i.withCredentials=!0,i.strictCallbacks=d||!1,window.onunload=function(){c&&a.terminate("User closed content")};var j=new ADL.XAPIWrapper.constructor;return j.changeConfig(i),setupCourseLinks(document.body.querySelectorAll("a")),observeForNewLinks(),b(null,f,j)},h.open("POST",g.toString(),!0),h.send()}catch(i){b(i)}};"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=xAPILaunch:window.ADL.launch=xAPILaunch;